# Deployment Pipeline Documentation

## Environment Structure

This project uses a three-tier deployment pipeline:

### 1. Development Environment
- **Branch:** `development`
- **URL:** Auto-generated by Netlify (e.g., `development--lookwithin.netlify.app`)
- **Purpose:** Active development and feature testing
- **Deploy:** Automatic on push to `development` branch

### 2. QA Environment
- **Branch:** `qa`
- **URL:** Auto-generated by Netlify (e.g., `qa--lookwithin.netlify.app`)
- **Purpose:** Quality assurance and testing before production
- **Deploy:** Automatic on push to `qa` branch

### 3. Production Environment
- **Branch:** `main`
- **URL:** Your primary domain (e.g., `lookwithin.netlify.app`)
- **Purpose:** Live production site
- **Deploy:** Automatic on push to `main` branch

## Workflow

### Feature Development
```bash
# 1. Start from development branch
git checkout development
git pull origin development

# 2. Create a feature branch
git checkout -b feature/your-feature-name

# 3. Make your changes and commit
git add .
git commit -m "Add your feature"

# 4. Push and create PR to development
git push origin feature/your-feature-name
# Create Pull Request on GitHub: feature/your-feature-name → development
```

### Moving to QA
```bash
# 1. Merge development into QA
git checkout qa
git pull origin qa
git merge development
git push origin qa

# QA deployment will trigger automatically
```

### Promoting to Production
```bash
# 1. After QA approval, merge to main
git checkout main
git pull origin main
git merge qa
git push origin main

# Production deployment will trigger automatically
```

## Environment Variables

Each environment has its own configuration file:
- `.env.development` - Development environment
- `.env.qa` - QA environment
- `.env.production` - Production environment

### Setting Environment Variables in Netlify

For sensitive variables (API keys, secrets):

1. Go to Netlify Dashboard → Site Settings → Environment Variables
2. Add variables for each deployment context:
   - **Production deploys:** Use `main` branch context
   - **QA deploys:** Use `qa` branch context
   - **Development deploys:** Use `development` branch context

## Netlify Setup

### Initial Setup

1. **Connect Repository:**
   - Go to https://app.netlify.com/
   - Click "Add new site" → "Import an existing project"
   - Choose GitHub and select: `lookwithinlifecoachingwebsite-sys/lookwithinlifecoach`

2. **Configure Branch Deploys:**
   - Go to Site Settings → Build & Deploy → Continuous Deployment
   - Under "Branch deploys," select "Let me add individual branches"
   - Add: `development` and `qa`

3. **Deploy Contexts:**
   - The `netlify.toml` file automatically configures different contexts
   - Each branch will deploy with its own environment variables

### Deploy Settings

All settings are configured in `netlify.toml`:
- Build command: `npm run build`
- Publish directory: `.next`
- Next.js plugin: Automatically installed

## Branch Protection (Recommended)

Set up branch protection rules on GitHub:

### Main Branch
- Require pull request reviews
- Require status checks to pass
- No direct pushes to main

### QA Branch
- Require pull request reviews
- At least 1 approval required

### Development Branch
- Allow direct pushes for faster iteration
- Require status checks to pass

## Rollback Strategy

If you need to rollback a deployment:

### Via Netlify UI
1. Go to Deploys tab
2. Find the last working deploy
3. Click "Publish deploy"

### Via Git
```bash
# Revert to a previous commit
git checkout main
git revert <commit-hash>
git push origin main
```

## Testing Deployments

Each branch gets its own URL:
- **Development:** Test features as they're developed
- **QA:** Full testing before production
- **Production:** Live site for end users

## Best Practices

1. **Always test in development first**
2. **Never push directly to main**
3. **Use pull requests for code review**
4. **Test thoroughly in QA before promoting**
5. **Keep branches in sync:**
   ```bash
   development → qa → main
   ```
6. **Use semantic commit messages**
7. **Tag production releases**

## Quick Reference

```bash
# Check current branch
git branch

# Switch branches
git checkout <branch-name>

# See deployment status
# Visit: https://app.netlify.com/

# Local development
npm run dev          # Development server
npm run build        # Test production build
npm run start        # Test production server locally
```

## Support

For issues or questions:
- Check Netlify deploy logs
- Review GitHub Actions (if configured)
- Verify environment variables in Netlify dashboard
